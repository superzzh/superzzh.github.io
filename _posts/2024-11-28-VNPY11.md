---
title: CTA：仿真交易总览
---

## 解决仿真交易的穷人版方案

一般来说，高质量的实时行情推送服务没有免费提供的，而购买费用对穷人不太友好。但是结合VNPY对掘金仿真交易终端的支持，可以简单实现仿真交易。

掘金仿真交易终端可以看作是一个仿真柜台，它可以提供交易时段的精准模拟撮合。故我们可以连接到掘金终端，在其上完成报单、撤单等操作，而且掘金终端也会为我们的交易记录生成绩效评估报告。

而免费实时行情推送则来自于Tushare数据接口。但是Tushare的数据也是爬取的，一次只能订阅50个标的。

这样，我暂时用Tushare接受实时Tick推送，用掘金终端作为交易柜台，实现穷人版仿真交易。

## 实盘中行情推送的总体思路

按照业务发生的顺序，行情的来龙去脉如下：
1. 将CTA引擎初始化，定义处理实时行情事件的处理函数，并注册到事件引擎中
2. 从网关（gateway，此处是Tushare）处获得实时行情，并将实时行情事件与Tick数据推送到事件引擎
3. 事件引擎对事件队列里面的事件依次调用其对应的处理函数
4. 当事件引擎处理到实时行情事件时，调用CTA引擎里所定义的处理函数，这个函数会接受Tick数据，并与CTA策略的回调函数绑定，最终实现将实时行情传到CTA策略的`on_tick`函数
5. 后续处理见CTA策略的`on_tick`函数

## 实盘中订单交易的总体思路

由里向外，订单经过了这些程序：
1. 在CTA策略中，根据交易信号发出交易指令，生成订单信息并上报给CTA引擎
2. CTA引擎将订单信息加工，上报给主引擎
3. 主引擎再将订单报给网关
4. 网关最终调用掘金终端的`gmtrade`中的交易接口，完成订单上报

与回测中不同的是，回测中的订单管理由`BacktestingEngine`完成，订单只是简单地储存在字典里。但是实盘时使用的是`trader`，由主引擎`MainEngine`搭配`OMSEngine`完成。