---
title: 股价是怎样形成的？——撮合成交机制与订单簿
date: 2024-07-10 16:00:00 +0800
categories: [市场微观机制]
tags: [市场微观机制]
---

## 委托

各类投资者委托券商发起交易订单，委托方式有两种：限价委托和市价委托。这样，下单时会发现有两种单：

- 限价委托Limit Order
    - 从朴素的交易者心理分析：
    - 卖股票的人不希望自己的股票贱卖，希望股票买个好价钱，于是给定一个价格，只希望以该价格或者更高价格成交
    - 买股票的人不希望自己买亏了股票，希望买到实惠的股票，于是给定一个价格，只希望以该价格或者更低价格成交

- 市价委托Market Order
    - 按照当前的市场价格买卖股票

市价委托单有四种交易方式

1. 对手方最优价格委托

    是指投资者无须指定委托价格，当委托申报指令进入交易主机时，交易主机以当时集中申报簿有效竞价范围内对手方队列的最优价格为其指定价格的委托类型。
    
    其功能设计为：

    - 只适用于连续竞价期间，不适用于集合竞价；
    - “对手方最优价格委托”无需输入指定价格，如果当时交易主机中集中申报簿的对手方队列中存在有效申报，则与当时对手方队列中价格最优的申报成交；“价格最优的申报”是指集中申报簿中买方“买一”队列或卖方“卖一”队列； 
    - 没有完全成交的“对手方最优价格委托”将以限价形式保存在交易主机集中申报簿的本方队列中，其指定价格为委托已成交部分的成交价，也就是委托申报进入交易主机当时对手方队列的最优价格；
    - 如果当时集中申报簿中对手方队列没有有效对手盘，交易主机直接对“对手方最优价格委托”作撤单处理；
    - “对手方最优价格委托”没有撮合优先权。

    简单说：

    - 对方最优价买：报单以卖一的价位成交，没成交的部分挂在卖一位置
    - 对方最优价卖：报单以买一的价位成交，没成交的部分挂在买一位置

2. 本方最优价格委托

    是指投资者无须指定委托价格，当委托申报指令进入交易主机时，交易主机以当时集中申报簿有效竞价范围内本方队列最优价格为其指定价格的委托类型。
    
    其功能设计为：

    - 只适用于连续竞价期间，不适用于集合竞价；
    - “本方最优价格委托”无需输入指定价格，如果当时交易主机中集中申报簿的本方队列存在有效申报，则以当时本方队列的最优价格为指定价格以限价形式保存在交易主机的集中申报簿中；
    - 如果当时集中申报簿本方队列中没有有效申报，交易主机对“本方最优价格委托”作撤销处理；
    - “本方最优价格委托”没有撮合优先权。进入集中申报簿时，“本方最优价格委托”依据“价格优先”原则排列在本方价格最优队列中；而根据“时间优先”原则，其在本方价格最优队列中是排列在该队列原有其他申报之后。

    简单说：

    - 本方最优价买：报单挂在买一位置，等待成交
    - 本方最优价卖：报单挂在卖一位置，等待成交

3. 即时成交剩余撤销委托

    是指无需指定委托价格，委托进入交易主机时能立即成交部分即予以撮合，未成交部分立即自动撤销的委托方式，一笔委托可以与对手方数笔不同价格的委托撮合成交。

    其功能设计为：

    - 只适用于连续竞价期间，不适用于集合竞价；
    - “即时成交剩余撤销委托”无需指定价格，如果当时交易主机集中申报簿的对手方队列中存在有效申报，则按对手方申报队列顺序以对手方价格为成交价进行逐笔配对； 
    - “即时成交剩余撤销委托”可以与不同价格的对手方委托撮合成交，直至无有效对手盘（即在涨跌幅限制范围内或在最后一笔成交价为基础的有效竞价范围内交易主机中现有的对手方队列中无委托）；
    - 若“即时成交剩余撤销委托”成交后有剩余的委托（包括部分成交、未有成交的情形），交易主机立即对剩余部分作撤单处理；
    - “即时成交剩余撤销委托”没有撮合优先权。

    简单说：

    - 即时成交并撤买：自动追涨买入，直至涨停，如还有未成交的自动撤单
    - 即时成交并撤卖：自动杀跌卖出，直至跌停，如还有未成交的自动撤单

4. 最优五档即时成交剩余撤销委托

    是为了避免市场价格波动过大而对“即时成交剩余撤销委托”的改良。其与“即时成交剩余撤销委托”方式的区别就在于“即时成交剩余撤销委托”可以与对手方数笔不同价格的委托撮合，直至无有效对手盘，而“最优五档即时成交剩余撤销委托”只能与一定范围内的对手方队列成交。

    其功能设计为：

    - 只适用于连续竞价期间，不适用于集合竞价；
    - “最优五档即时成交剩余撤销委托”无需指定价格，如果交易主机集中申报簿的对手方队列中存在有效申报，则按对手方申报队列顺序以对手方价格为成交价进行逐笔配对；
    - “最优五档即时成交剩余撤销委托”只允许与有效竞价范围内对手方最优五个价位的申报队列撮合成交；
    - 若“最优五档即时成交剩余撤销委托”成交后有剩余的委托（包括部分成交、未有成交的情形），交易主机立即对剩余部分作撤单处理；

    简单说：

    - 优五成交并撤买：在卖方五档挂单内逐价成交，如还有未成交的自动撤单
    - 优五成交并撤卖：在买方五档挂单内逐价成交，如还有未成交的自动撤单

简化总结一下：

对方最优价就是你的成交价就是卖一价格（如能成交的话，一般这个委托成交速度最快，只要不是体量非常大，除限价委托外首选该项），本方最优价是买一的价格（这个价格未必马上能成交，这个你应能理解），即时成交就是不停的买或卖，直到没有买单或者卖单供你成交，最优五档即时成交就是在前面基础上价格限制，价格超出买5或者卖5就STOP！

## 申报

以上交所股票市场为例，每个交易日的9:15至9:25为开盘集合竞价时间，9:30至11:30、13:00至14:57为连续竞价时间，14:57至15:00为收盘集合竞价时间。其中：
- 9:20至9:25的开盘集合竞价阶段、14:57至15:00的收盘集合竞价阶段，交易主机不接受撤单申报
- 其他接受交易申报的时间内，未成交申报可以撤销

## 竞价

证券竞价交易采用集合竞价和连续竞价两种方式：
- 集合竞价：在规定时间内接受的买卖申报一次性集中撮合的竞价方式
- 连续竞价：对买卖申报逐笔连续撮合的竞价方式

## 成交

交易市场上，买卖股票的投资者很多，这些交易订单是怎样成交的？

证券竞价交易按价格优先、时间优先的原则撮合成交：
- 成交时价格优先的原则为：较高价格买入申报优先于较低价格买入申报，较低价格卖出申报优先于较高价格卖出申报。
- 成交时时间优先的原则为：买卖方向、价格相同的，先申报者优先于后申报者。先后顺序按交易主机接受申报的时间确定。
这样的原则与上面分析的交易者心理是吻合的。

### 连续竞价

在连续竞价时，正在排队等待成交的订单会反应在订单簿上：

|     | 申报量 | 申报价 |        |        |      |
|:----|:-------|:-------|:-------|:-------|:----|
| 卖5 | 1      | 7000   |       |        |      |
| 卖4 | 5      | 6500   |       |        |      |
| 卖3 | 6      | 6000   |       |        |      |
| 卖2 | 10     | 5500   |       |        |      |
| 卖1 | 9      | 5000   |       |        |      |
|:----|:-------|:-------|:-------|:-------|:----|
|     |        |        | 4500   | 7      | 买1 |
|     |        |        | 4000   | 9      | 买2 |
|     |        |        | 3500   | 2      | 买3 |
|     |        |        | 3000   | 2      | 买4 |
|     |        |        | 2500   | 6      | 买5 |
|:----|:-------|:-------|:-------|:-------|:----|
|     |        |        | 申报价 | 申报量  |     |

卖1与买1分别是买卖双方最接近成交价的价格，此处卖1~卖5向上依次递增，买1~买5向下依次递减，订单簿有两个特点：
- 符合上面分析的交易者心理：卖方能接受不低于出价的成交，即卖价及卖价上方的价格；买方同理，买方能接受不高于出价的成交，即买价及买价下方的价格
- 符合上面阐明的价格优先原则：买方喜欢较低卖价，而卖方喜欢较高买价

在上面这个时刻的订单簿中，最低卖价高于最高买价，故无成交。下一时刻，出现了新的卖单：

|     | 申报量 | 申报价 |        |        |      |
|:----|:-------|:-------|:-------|:-------|:----|
| 卖6 | 1      | 7000   |       |        |      |
| 卖5 | 5      | 6500   |       |        |      |
| 卖4 | 6      | 6000   |       |        |      |
| 卖3 | 10     | 5500   |       |        |      |
| 卖2 | 9      | 5000   |       |        |      |
| 卖1 | 3      | 4500   | 4500   | 7      | 买1 |
|     |        |        | 4000   | 9      | 买2 |
|     |        |        | 3500   | 2      | 买3 |
|     |        |        | 3000   | 2      | 买4 |
|     |        |        | 2500   | 6      | 买5 |
|:----|:-------|:-------|:-------|:-------|:----|
|     |        |        | 申报价 | 申报量  |     |

此时卖1价与买1价相同，立即成交，最新成交价：4500，成交量：3笔。最新股价就定为4500。订单簿更新为如下状态:

|     | 申报量 | 申报价 |        |        |      |
|:----|:-------|:-------|:-------|:-------|:----|
| 卖5 | 1      | 7000   |       |        |      |
| 卖4 | 5      | 6500   |       |        |      |
| 卖3 | 6      | 6000   |       |        |      |
| 卖2 | 10     | 5500   |       |        |      |
| 卖1 | 9      | 5000   |       |        |      |
|:----|:-------|:-------|:-------|:-------|:----|
|     |        |        | 4500   | 4      | 买1 |
|     |        |        | 4000   | 9      | 买2 |
|     |        |        | 3500   | 2      | 买3 |
|     |        |        | 3000   | 2      | 买4 |
|     |        |        | 2500   | 6      | 买5 |
|:----|:-------|:-------|:-------|:-------|:----|
|     |        |        | 申报价 | 申报量  |     |

下一时刻，又出现了新的卖单：

|     | 申报量 | 申报价 |        |        |      |
|:----|:-------|:-------|:-------|:-------|:----|
| 卖5 | 1      | 7000   |       |        |      |
| 卖4 | 5      | 6500   |       |        |      |
| 卖3 | 6      | 6000   |       |        |      |
| 卖2 | 10     | 5500   |       |        |      |
| 卖1 | 9      | 5000   | 5000   | 5      | 买1  |
|:----|:-------|:-------|:-------|:-------|:----|
|     |        |        | 4500   | 4      | 买2 |
|     |        |        | 4000   | 9      | 买3 |
|     |        |        | 3500   | 2      | 买4 |
|     |        |        | 3000   | 2      | 买5 |
|     |        |        | 2500   | 6      | 买6 |
|:----|:-------|:-------|:-------|:-------|:----|
|     |        |        | 申报价 | 申报量  |     |

此时卖1价与买1价相同，立即成交，最新成交价：5000，成交量：5笔。最新股价就定为5000。订单簿更新为如下状态:

|     | 申报量 | 申报价 |        |        |      |
|:----|:-------|:-------|:-------|:-------|:----|
| 卖5 | 1      | 7000   |       |        |      |
| 卖4 | 5      | 6500   |       |        |      |
| 卖3 | 6      | 6000   |       |        |      |
| 卖2 | 10     | 5500   |       |        |      |
| 卖1 | 4      | 5000   |       |        |      |
|:----|:-------|:-------|:-------|:-------|:----|
|     |        |        | 4500   | 4      | 买1 |
|     |        |        | 4000   | 9      | 买2 |
|     |        |        | 3500   | 2      | 买3 |
|     |        |        | 3000   | 2      | 买4 |
|     |        |        | 2500   | 6      | 买5 |
|:----|:-------|:-------|:-------|:-------|:----|
|     |        |        | 申报价 | 申报量  |     |

这样，就解释了股价是怎么确定的：

> 股价根据买卖双方即时成交价确定，它是双方博弈的体现。
{: .prompt-tip}

总结下来，连续竞价的成交价格确定原则为：
- 最高买入申报价格与最低卖出申报价格相同，以该价格为成交价格
- 买入申报价格高于即时揭示的最低卖出申报价格的，以即时揭示的最低卖出申报价格为成交价格
- 卖出申报价格低于即时揭示的最高买入申报价格的，以即时揭示的最高买入申报价格为成交价格

实际交易中会存在买卖价差，即买价和卖价之间存在差异。以上展示的情况中，都是最优买价和最优卖价相等而成交。但是股票买入价高于卖出价时，按什么价格成交？价格优先结合盘口来看：
- 买入：挂单如果等于或高于卖1的价格，那么成交价就是卖1价格。主动买入的算入外盘。
- 卖出：挂单如果等于或低于买1的价格，那么成交价就是买1的价格。主动卖出的算入内盘。

这样的买卖价差可以如下解读：
- 与谁主动出击有关，客观上可以鼓励交易，不让主动的人吃亏。即卖个好价钱，捡个便宜货。
- 同样遵循时间优先原则，假如先有卖单，买家主动出击想吃下卖单，仍以卖价成交。

流动性较好的情况下，买卖价差小，供需趋近平衡。一般在行情软件中，我们看到的订单簿上的挂单买1价和卖1价会相差0.1。

假如本金融大鳄想让某支股票瞬间涨停，就这样做：

> 提交巨额涨停买单，把卖单通通吃光，直到最后吃到涨停卖单，此时股价跳至涨停价。成交价格是中间的每一笔买入价格，成本是它们的加权平均值。

### 集合竞价

- 集合竞价的作用是产生股票的开盘价
    - 沪深交易所每个交易日9:15~9:25的集合竞价期间，系统只存储每一笔申报，并且进行模拟撮合而不实际成交，至9:25时，电脑系统将根据已输入的所有买卖申报按集合竞价的规则产生一个开盘价。
    - 按照最新交易规则：9:15~9:25，即时行情显示内容包括证券代码、证券简称、前收盘价格、虚拟开盘参考价格、虚拟匹配量和虚拟匹配后剩余量。

- 集合竞价的过程

    - 9:15~9:20：这5分钟可以撤单，很多主力在9:19:30左右撤单，乃表演时刻。
    - 9:20~9:25：这5分钟为开放式集合竞价，可以委托买单或者卖单，但不能撤单。这5分钟你看到的委托是真实的，抢涨停板一定要看准这五分钟。
    - 9:25:集合竞价期间唯一一次真正的成交，会显示成交笔数。卖出股票的资金9:25就能到账，马上就可以使用。
    - 9:25~9:30：这5分钟不叫集合竞价时间，但系统可接收买卖委托，也可接收撤单，这五分钟电脑不处理。对于高手而言，这五分钟换股票一定要利用，比如你集合竞价卖出股票后，资金在立刻就可利用，你可在9:26买进另一只股票。
    - 集合竞价最大成交量原则：集合定价由交易处理系统对全部申报按照价格优先、时间优先的原则排序，并在此基础上，找出一个基准价格，使它同时能满足以下3个条件：
        - 成交量最大
        - 高于该价格的买入申报与低于该价格的卖出申报全部成交
        - 与该价格相同的买方或卖方至少有一方全部成交的价格
    - 该基准价格即被确定为成交价格，集合竞价方式产生成交价格的全部过程，完全由电脑交易系统进行程序化处理，将处理后所产生的成交价格显示出来。
    - 这里需要说明的是：
        - 第一，集合竞价方式下价格优先、时间优先原则体现在交易主机将所有的买入和卖出申报按价格由高到低排出序列，同一价格下的申报原则按交易主机接受的先后顺序排序；
        - 第二，集合竞价过程中，若有多个以上的价格同时满足集合竞价的3个条件时，沪市选取这几个基准价格的中间价格为成交价格，深市则选取离前收盘价最近的价格为成交价格。 
    - 由于集合竞价大家的成交价一样，所以如果你想买入一只股票，你直接挂涨停价买入即可，如果你想卖出一只股票，你直接挂跌停价即可，这样基本都可以买到或抛出，但它的实际成交价格不是你所挂的涨停价或跌停价，而是9:25成交的那个价格，也就是开盘价。当然如果是以涨停板和跌停板开盘的话，就不一定可以买到，挂单价格相同的情况下，时间优先，交易所接收到的挂单的时间越靠前，越优先成交。

- 尾盘集合竞价
    - 尾盘14:57~15:00的最后三分钟也是集合竞价的，不可撤单，形成最终收盘价。成交规则和开盘很相似。